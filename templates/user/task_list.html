{% extends 'user/dashboard.html' %}

{% block content %}
<div class="container mt-4">
    <h3>Tasks</h3>

    <!-- Filter -->
    <div class="mb-3">
        <form method="get" class="d-flex gap-2">
            <input type="text" name="search" placeholder="Search tasks..." value="{{ search }}" class="form-control w-25">
            <select name="status" class="form-select w-25">
                <option value="">All Statuses</option>
                {% for value, label in status_choices %}
                <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
            <button class="btn btn-primary">Filter</button>
        </form>
    </div>

    <!-- Task List -->
    {% if page_obj %}
        <div class="list-group">
            {% for task in page_obj %}
            <a href="{% url 'user_task_detail' task.id %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ task.title }}</strong>
                    <p class="mb-0">{{ task.description|truncatechars:50 }}</p>
                </div>
                <span class="badge bg-{{ task.status|default:'secondary' }}">{{ task.get_status_display }}</span>
            </a>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <nav aria-label="Page navigation" class="mt-3">
            <ul class="pagination">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">&laquo;</a>
                </li>
                {% endif %}
                {% for num in page_obj.paginator.page_range %}
                <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
                {% endfor %}
                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">&raquo;</a>
                </li>
                {% endif %}
            </ul>
        </nav>
    {% else %}
        <div class="alert alert-info">
            No tasks found.
        </div>
    {% endif %}
</div>
{% endblock %}
